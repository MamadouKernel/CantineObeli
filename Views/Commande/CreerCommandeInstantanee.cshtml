@model Obeli_K.Models.ViewModels.CreerCommandeInstantaneeViewModel

@{
    ViewData["Title"] = "Créer une Commande Instantanée";
}

<style>
    .instant-order-container {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
        padding: 2rem 0;
    }
    
    .main-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        overflow: hidden;
        background: white;
    }
    
    .header-section {
        background: #EDAC00;
        color: #2c3e50;
        padding: 2rem;
        text-align: center;
        position: relative;
    }
    
    .header-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }
    
    .header-content {
        position: relative;
        z-index: 1;
    }
    
    .form-section {
        padding: 3rem;
        background: white;
    }
    
    .form-group {
        margin-bottom: 2rem;
    }
    
    .form-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        font-size: 0.95rem;
    }
    
    .form-label i {
        color: #EDAC00;
        margin-right: 0.5rem;
        width: 20px;
        text-align: center;
    }
    
    .form-control, .form-select {
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 0.875rem 1rem;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #EDAC00;
        box-shadow: 0 0 0 0.2rem rgba(237, 172, 0, 0.25);
        background: white;
    }
    
    .form-control:hover, .form-select:hover {
        border-color: #EDAC00;
        background: white;
    }
    
    .btn-primary {
        background: #EDAC00;
        border: none;
        border-radius: 12px;
        padding: 0.875rem 2rem;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s ease;
        color: #2c3e50;
    }
    
    .btn-primary:hover {
        background: #d4b800;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(237, 172, 0, 0.4);
        color: #2c3e50;
    }
    
    .btn-secondary {
        background: #6c757d;
        border: none;
        border-radius: 12px;
        padding: 0.875rem 2rem;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
    }
    
    .alert {
        border: none;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        margin-bottom: 2rem;
    }
    
    .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
    }
    
    .alert-success {
        background: #d1edff;
        color: #0c5460;
        border-left: 4px solid #17a2b8;
    }
    
    .section-divider {
        height: 2px;
        background: linear-gradient(90deg, transparent, #EDAC00, transparent);
        margin: 2rem 0;
        border: none;
    }
    
    .floating-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border: 1px solid #f1f3f4;
        transition: all 0.3s ease;
    }
    
    .floating-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
    }
    
    .step {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 1rem;
        font-weight: 600;
        color: #6c757d;
        transition: all 0.3s ease;
    }
    
    .step.active {
        background: #EDAC00;
        color: #2c3e50;
    }
    
    .step.completed {
        background: #28a745;
        color: white;
    }
    
    .step-line {
        width: 60px;
        height: 2px;
        background: #e9ecef;
        margin-top: 19px;
    }
    
    .step-line.completed {
        background: #EDAC00;
    }
    
    /* Select2 Custom Styles */
    .select2-container {
        width: 100% !important;
    }
    
    .select2-container--default .select2-selection--single {
        height: 50px;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        background: #f8f9fa;
        transition: all 0.3s ease;
    }
    
    .select2-container--default .select2-selection--single:hover {
        border-color: #EDAC00;
        background: white;
    }
    
    .select2-container--default.select2-container--focus .select2-selection--single {
        border-color: #EDAC00;
        box-shadow: 0 0 0 0.2rem rgba(237, 172, 0, 0.25);
        background: white;
    }
    
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 46px;
        padding-left: 1rem;
        color: #2c3e50;
        font-size: 0.95rem;
    }
    
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 46px;
        right: 1rem;
    }
    
    .select2-dropdown {
        border: 2px solid #EDAC00;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .select2-results__option {
        padding: 0.75rem 1rem;
        font-size: 0.95rem;
        color: #2c3e50;
    }
    
    .select2-results__option--highlighted {
        background: #EDAC00;
        color: #2c3e50;
    }
    
    .select2-search--dropdown .select2-search__field {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 0.5rem 0.75rem;
        font-size: 0.95rem;
    }
    
    .select2-search--dropdown .select2-search__field:focus {
        border-color: #EDAC00;
        box-shadow: 0 0 0 0.2rem rgba(237, 172, 0, 0.25);
    }
    
    .select2-container--default .select2-selection--single .select2-selection__placeholder {
        color: #6c757d;
    }
    
    /* Styles pour les templates personnalisés */
    .select2-result-item {
        padding: 0.5rem 0;
    }
    
    .select2-result-item__title {
        font-weight: 600;
        color: #2c3e50;
        font-size: 0.95rem;
    }
    
    .select2-result-item__matricule {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }
    
    .select2-results__option--highlighted .select2-result-item__matricule {
        color: #2c3e50;
    }
    
    /* Forcer l'affichage de la barre de recherche */
    .select2-dropdown-with-search .select2-search {
        display: block !important;
    }
    
    .select2-dropdown-with-search .select2-search--dropdown {
        display: block !important;
        padding: 0.5rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .select2-dropdown-with-search .select2-search__field {
        width: 100% !important;
        padding: 0.5rem 0.75rem !important;
        border: 2px solid #e9ecef !important;
        border-radius: 8px !important;
        font-size: 0.95rem !important;
        background: #f8f9fa !important;
        transition: all 0.3s ease !important;
    }
    
    .select2-dropdown-with-search .select2-search__field:focus {
        border-color: #EDAC00 !important;
        box-shadow: 0 0 0 0.2rem rgba(237, 172, 0, 0.25) !important;
        background: white !important;
        outline: none !important;
    }
    
    .select2-dropdown-with-search .select2-search__field::placeholder {
        color: #6c757d !important;
        font-style: italic !important;
    }
    
    /* Styles pour la barre de recherche personnalisée */
    #searchUtilisateur {
        border: 2px solid #EDAC00 !important;
        border-radius: 12px !important;
        padding: 0.875rem 1rem !important;
        font-size: 0.95rem !important;
        background: #f8f9fa !important;
        transition: all 0.3s ease !important;
        width: 100% !important;
    }
    
    #searchUtilisateur:focus {
        border-color: #EDAC00 !important;
        box-shadow: 0 0 0 0.2rem rgba(237, 172, 0, 0.25) !important;
        background: white !important;
        outline: none !important;
    }
    
    #searchUtilisateur::placeholder {
        color: #6c757d !important;
        font-style: italic !important;
    }
    
    #searchUtilisateur:hover {
        border-color: #EDAC00 !important;
        background: white !important;
    }
    
    /* Style pour l'alerte d'information */
    .alert-info {
        background-color: #e3f2fd !important;
        border: 1px solid #bbdefb !important;
        color: #1565c0 !important;
        border-radius: 8px !important;
        padding: 0.5rem 0.75rem !important;
        font-size: 0.85rem !important;
    }
    
    .alert-info .fas {
        color: #1976d2 !important;
    }
    
    /* Styles pour les messages d'erreur détaillés */
    .field-validation-error {
        background-color: #f8d7da !important;
        border: 1px solid #f5c6cb !important;
        color: #721c24 !important;
        border-radius: 8px !important;
        padding: 1rem !important;
        margin-top: 0.5rem !important;
        font-size: 0.9rem !important;
        line-height: 1.4 !important;
    }
    
    .field-validation-error strong {
        color: #721c24 !important;
        font-weight: 600 !important;
    }
    
    .field-validation-error em {
        color: #6c757d !important;
        font-style: italic !important;
    }
    
    @@media (max-width: 768px) {
        .instant-order-container {
            padding: 1rem 0;
        }
        
        .form-section {
            padding: 2rem 1.5rem;
        }
        
        .header-section {
            padding: 1.5rem;
        }
        
        .select2-container--default .select2-selection--single {
            height: 45px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 41px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 41px;
        }
    }
</style>

<div class="instant-order-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                
                <div class="main-card">
                    <!-- Header Section -->
                    <div class="header-section">
                        <div class="header-content">
                            <h1 class="mb-3">
                                <i class="fas fa-bolt me-3"></i>
                                Commande Instantanée
                            </h1>
                            <p class="mb-0 fs-5">
                                <i class="fas fa-calendar-alt me-2"></i>
                                @ViewBag.DateAujourdhui?.ToString("dddd dd MMMM yyyy", new System.Globalization.CultureInfo("fr-FR"))
                            </p>
                        </div>
                </div>
                    
                    <!-- Form Section -->
                    <div class="form-section">
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            @TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                                    <form asp-action="CreerCommandeInstantanee" method="post">
                                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                            
                            <!-- Step 1: Client Type & Formula -->
                            <div class="floating-card">
                                <h5 class="mb-4 text-center">
                                    <i class="fas fa-user-friends me-2" style="color: #EDAC00;"></i>
                                    Informations de base
                                </h5>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                        <div class="form-group">
                                                    <label asp-for="TypeClient" class="form-label">
                                                <i class="fas fa-users"></i>
                                                        Type de client
                                                    </label>
                                                    <select asp-for="TypeClient" class="form-select" id="typeClientSelect" onchange="
                                                        var typeClient = this.value;
                                                        var groupeSection = document.getElementById('groupeSection');
                                                        var groupeCitSection = document.getElementById('groupeCitSection');
                                                        var quantiteSection = document.getElementById('quantiteSection');
                                                        var quantiteInput = document.getElementById('Quantite');
                                                        var siteSection = document.getElementById('siteSection');
                                                        
                                                        // Masquer toutes les sections
                                                        if (groupeSection) groupeSection.style.display = 'none';
                                                        if (groupeCitSection) groupeCitSection.style.display = 'none';
                                                        
                                                        // Afficher selon la sélection
                                                        if (typeClient === '1') {
                                                            // Groupe non-CIT
                                                            if (groupeSection) groupeSection.style.display = 'block';
                                                            if (quantiteSection) quantiteSection.style.display = 'block';
                                                            if (siteSection) {
                                                                siteSection.className = 'col-md-6';
                                                            }
                                                        } else if (typeClient === '0') {
                                                            // Groupe CIT
                                                            if (groupeCitSection) groupeCitSection.style.display = 'block';
                                                            if (quantiteSection) quantiteSection.style.display = 'none';
                                                            if (quantiteInput) quantiteInput.value = '1';
                                                            if (siteSection) {
                                                                siteSection.className = 'col-md-8';
                                                            }
                                                        } else {
                                                            // Par défaut
                                                            if (quantiteSection) quantiteSection.style.display = 'block';
                                                            if (siteSection) {
                                                                siteSection.className = 'col-md-6';
                                                            }
                                                        }
                                                    ">
                                                        <option value="">-- Sélectionner --</option>
                                                        <option value="1">Groupe non-CIT</option>
                                                        <option value="0">Groupe CIT</option>
                                                    </select>
                                                    <span asp-validation-for="TypeClient" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                        <div class="form-group">
                                                    <label asp-for="IdFormule" class="form-label">
                                                <i class="fas fa-utensils"></i>
                                                        Formule
                                                    </label>
                                            <select asp-for="IdFormule" class="form-select select2-search" asp-items="ViewBag.FormulesAujourdhui" data-placeholder="-- Rechercher une formule --">
                                                <option value="">-- Rechercher une formule --</option>
                                                    </select>
                                                    <span asp-validation-for="IdFormule" class="text-danger"></span>
                                        </div>
                                                </div>
                                            </div>
                                        </div>

                            <!-- Step 2: Client Details -->
                            <div id="groupeSection" class="floating-card" style="display: none;">
                                <h5 class="mb-4 text-center">
                                    <i class="fas fa-building me-2" style="color: #EDAC00;"></i>
                                    Détails du groupe non-CIT
                                </h5>
                                <div class="row">
                                            <div class="col-md-6">
                                        <div class="form-group">
                                                    <label asp-for="GroupeNonCitId" class="form-label">
                                                <i class="fas fa-building"></i>
                                                        Groupe non-CIT
                                                    </label>
                                            <select asp-for="GroupeNonCitId" class="form-select select2-search" asp-items="ViewBag.GroupesNonCit" data-placeholder="-- Rechercher un groupe --">
                                                <option value="">-- Rechercher un groupe --</option>
                                                    </select>
                                                    <span asp-validation-for="GroupeNonCitId" class="text-danger"></span>
                                        </div>
                                                </div>
                                            </div>
                                        </div>

                            <div id="groupeCitSection" class="floating-card" style="display: none;">
                                <h5 class="mb-4 text-center">
                                    <i class="fas fa-user me-2" style="color: #EDAC00;"></i>
                                    Détails de l'utilisateur CIT
                                </h5>
                                
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label asp-for="UtilisateurId" class="form-label">
                                                <i class="fas fa-user"></i>
                                                Utilisateur CIT
                                            </label>
                                            <div class="alert alert-info alert-sm mb-2">
                                                <i class="fas fa-info-circle me-1"></i>
                                                <small><strong>Règle importante :</strong> Un utilisateur CIT ne peut avoir qu'une seule commande instantanée par jour. Le système vérifiera automatiquement s'il existe déjà une commande et son statut (en attente, validée, ou annulée).</small>
                                            </div>
                                            
                                            <select asp-for="UtilisateurId" class="form-select select2-search" data-placeholder="-- Tapez le nom ou matricule pour rechercher --">
                                                <option value="">-- Sélectionner un utilisateur --</option>
                                                @if (ViewBag.Utilisateurs != null && ViewBag.UtilisateursData != null)
                                                {
                                                    @foreach (var item in ViewBag.Utilisateurs)
                                                    {
                                                        var userName = ViewBag.UtilisateursData[item.Value];
                                                        <option value="@item.Value" data-username="@userName" data-fulltext="@item.Text @userName">@item.Text (@userName)</option>
                                                    }
                                                }
                                            </select>
                                            <span asp-validation-for="UtilisateurId" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: Order Details -->
                            <div class="floating-card">
                                <h5 class="mb-4 text-center">
                                    <i class="fas fa-cog me-2" style="color: #EDAC00;"></i>
                                    Détails de la commande
                                </h5>
                                
                                <div class="row">
                                    <div class="col-md-2" id="quantiteSection">
                                        <div class="form-group">
                                                <label asp-for="Quantite" class="form-label">
                                                <i class="fas fa-hashtag"></i>
                                                    Quantité
                                                </label>
                                                <input asp-for="Quantite" class="form-control" type="number" min="1" max="100" />
                                                <span asp-validation-for="Quantite" class="text-danger"></span>
                                            </div>
                                        </div>
                                            <div class="col-md-4">
                                        <div class="form-group">
                                                    <label asp-for="PeriodeService" class="form-label">
                                                <i class="fas fa-clock"></i>
                                                        Période de service
                                                    </label>
                                                    <select asp-for="PeriodeService" class="form-select">
                                                        <option value="0">Jour</option>
                                                        <option value="1">Nuit</option>
                                                    </select>
                                                    <span asp-validation-for="PeriodeService" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6" id="siteSection">
                                        <div class="form-group">
                                                    <label asp-for="Site" class="form-label">
                                                <i class="fas fa-map-marker-alt"></i>
                                                        Site
                                                    </label>
                                                    <select asp-for="Site" class="form-select">
                                                        <option value="">-- Sélectionner --</option>
                                                        <option value="0">CIT-Terminal</option>
                                                        <option value="1">CIT-Billing</option>
                                                    </select>
                                                    <span asp-validation-for="Site" class="text-danger"></span>
                                        </div>
                                                </div>
                                            </div>
                                        </div>

                            <!-- Action Buttons -->
                            <div class="d-flex justify-content-between mt-4">
                                            <a asp-action="Index" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>
                                                Retour à la liste
                                            </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-bolt me-2"></i>
                                                Créer la commande instantanée
                                            </button>
                                        </div>
                                    </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/fr.js"></script>
    
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Initialisation quand le DOM est prêt
        document.addEventListener('DOMContentLoaded', function() {
            
            // Fonction pour initialiser Select2
            function initSelect2() {
                if (typeof $ !== 'undefined' && typeof $.fn.select2 !== 'undefined') {
                    console.log('✅ jQuery et Select2 sont chargés');
                    // Variable globale pour stocker le terme de recherche
                    window.searchTerm = '';
                    
                    // Configuration Select2 avec recherche par matricule
                    $('#UtilisateurId').select2({
                        language: 'fr',
                        placeholder: '-- Tapez le nom ou matricule pour rechercher --',
                        allowClear: true,
                        width: '100%',
                        dropdownParent: $('.main-card'),
                        minimumInputLength: 0,
                        minimumResultsForSearch: 0,
                        matcher: function(params, data) {
                            // Si aucun terme de recherche, afficher tous les résultats
                            if ($.trim(params.term) === '') {
                                return data;
                            }
                            
                            var term = params.term.toLowerCase();
                            
                            // Rechercher dans le texte affiché (nom)
                            if (data.text.toLowerCase().indexOf(term) > -1) {
                                return data;
                            }
                            
                            // Rechercher dans le matricule (data-username)
                            if (data.element) {
                                var $element = $(data.element);
                                var matricule = $element.attr('data-username');
                                if (matricule && matricule.toLowerCase().indexOf(term) > -1) {
                                    return data;
                                }
                            }
                            
                            return null;
                        },
                        templateResult: function(data) {
                            if (!data.id) {
                                return data.text;
                            }
                            
                            var $element = $(data.element);
                            var matricule = $element.attr('data-username');
                            
                            if (matricule) {
                                var $result = $(
                                    '<div class="select2-result-item">' +
                                        '<div class="select2-result-item__title">' + data.text + '</div>' +
                                        '<div class="select2-result-item__matricule">Matricule: ' + matricule + '</div>' +
                                    '</div>'
                                );
                                return $result;
                            }
                            
                            return data.text;
                        },
                        templateSelection: function(data) {
                            var $element = $(data.element);
                            var matricule = $element.attr('data-username');
                            
                            if (matricule) {
                                return data.text + ' (' + matricule + ')';
                            }
                            return data.text;
                        }
                    });
                    
                    console.log('✅ Select2 configuré avec recherche par matricule');
                    
                    // Configuration standard pour les autres champs
                    $('.select2-search').not('#typeClientSelect').not('#UtilisateurId').select2({
                        language: 'fr',
                        placeholder: function() {
                            return $(this).data('placeholder') || '-- Sélectionner --';
                        },
                        allowClear: true,
                        width: '100%',
                        dropdownParent: $('.main-card'),
                        minimumInputLength: 0,
                        minimumResultsForSearch: 0,
                        searchInputPlaceholder: 'Rechercher...',
                        templateResult: function(data) {
                            if (!data.id) {
                                return data.text;
                            }
                            
                            // Mise en forme spéciale pour les utilisateurs avec matricule
                            if (data.element && data.element.dataset && data.element.dataset.matricule) {
                                var $result = $(
                                    '<div class="select2-result-item">' +
                                        '<div class="select2-result-item__title">' + data.text + '</div>' +
                                        '<div class="select2-result-item__matricule">Matricule: ' + data.element.dataset.matricule + '</div>' +
                                    '</div>'
                                );
                                return $result;
                            }
                            
                            return data.text;
                        },
                        templateSelection: function(data) {
                            if (data.element && data.element.dataset && data.element.dataset.matricule) {
                                return data.text + ' (' + data.element.dataset.matricule + ')';
                            }
                            return data.text;
                        }
                    });
                }
                
                // Debug pour vérifier les données
                console.log('Utilisateurs dans ViewBag:', @Html.Raw(Json.Serialize(ViewBag.Utilisateurs)));
                console.log('UtilisateursData dans ViewBag:', @Html.Raw(Json.Serialize(ViewBag.UtilisateursData)));
                
                // Initialiser l'affichage
                toggleClientSections();
                
            } else {
                console.log('❌ Select2 non disponible, nouvelle tentative dans 1 seconde...');
                setTimeout(initSelect2, 1000);
            }
        }
        
        // Démarrer l'initialisation
        setTimeout(initSelect2, 1000);
        });

            // Validation côté client
        document.addEventListener('DOMContentLoaded', function() {
            var form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    var typeClient = document.getElementById('typeClientSelect').value;
                var isValid = true;

                // Réinitialiser les classes d'erreur
                    var formControls = document.querySelectorAll('.form-control, .form-select');
                    formControls.forEach(function(control) {
                        control.classList.remove('is-invalid');
                    });

                // Validation selon le type de client
                switch(typeClient) {
                    case '1': // GroupeNonCit
                            var groupeNonCitId = document.getElementById('GroupeNonCitId');
                            if (groupeNonCitId && !groupeNonCitId.value) {
                                groupeNonCitId.classList.add('is-invalid');
                            isValid = false;
                        }
                        break;
                    case '0': // Groupe CIT
                            var utilisateurId = document.getElementById('UtilisateurId');
                            if (utilisateurId && !utilisateurId.value) {
                                utilisateurId.classList.add('is-invalid');
                            isValid = false;
                        }
                        break;
                }

                if (!isValid) {
                    e.preventDefault();
                    alert('Veuillez remplir tous les champs obligatoires.');
                }
            });
            }
        });
    </script>
}