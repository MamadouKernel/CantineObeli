@model Obeli_K.Models.ViewModels.ResetPasswordViewModel
@{
    ViewData["Title"] = "Réinitialisation de mot de passe";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="text-primary mb-1">
                        <i class="fas fa-key me-2"></i>
                        Réinitialisation de mot de passe
                    </h2>
                    <p class="text-muted mb-0">
                        Réinitialisez le mot de passe pour plusieurs utilisateurs
                    </p>
                </div>
                <div>
                    <a href="@Url.Action("List")" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Retour à la liste
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Instructions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">Format des matricules :</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Un matricule par ligne</li>
                                <li><i class="fas fa-check text-success me-2"></i>Séparés par des virgules (,)</li>
                                <li><i class="fas fa-check text-success me-2"></i>Séparés par des points-virgules (;)</li>
                                <li><i class="fas fa-check text-success me-2"></i>Espaces automatiquement supprimés</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-warning">Important :</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-shield-alt text-warning me-2"></i>Le nouveau mot de passe sera appliqué à tous les utilisateurs sélectionnés</li>
                                <li><i class="fas fa-user-check text-info me-2"></i>Seuls les matricules existants seront traités</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>Les utilisateurs n'auront pas besoin de changer leur mot de passe à la prochaine connexion</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulaire -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <form asp-action="ResetPassword" method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Matricules" class="form-label">
                                        <i class="fas fa-users me-2"></i>
                                        Matricules des utilisateurs
                                    </label>
                                    <textarea asp-for="Matricules" 
                                              class="form-control" 
                                              rows="8" 
                                              placeholder="Saisissez les matricules des utilisateurs (un par ligne ou séparés par des virgules)&#10;Exemple:&#10;EMP001&#10;EMP002&#10;EMP003&#10;&#10;Ou:&#10;EMP001, EMP002, EMP003"></textarea>
                                    <span asp-validation-for="Matricules" class="text-danger"></span>
                                    <div class="form-text">
                                        Saisissez les matricules des utilisateurs dont vous souhaitez réinitialiser le mot de passe.
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="NouveauMotDePasse" class="form-label">
                                        <i class="fas fa-lock me-2"></i>
                                        Nouveau mot de passe
                                    </label>
                                    <input asp-for="NouveauMotDePasse" 
                                           type="password" 
                                           class="form-control" 
                                           placeholder="Saisissez le nouveau mot de passe">
                                    <span asp-validation-for="NouveauMotDePasse" class="text-danger"></span>
                                    <div class="form-text">
                                        Le mot de passe doit contenir au moins 6 caractères.
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label asp-for="ConfirmerMotDePasse" class="form-label">
                                        <i class="fas fa-lock me-2"></i>
                                        Confirmer le nouveau mot de passe
                                    </label>
                                    <input asp-for="ConfirmerMotDePasse" 
                                           type="password" 
                                           class="form-control" 
                                           placeholder="Confirmez le nouveau mot de passe">
                                    <span asp-validation-for="ConfirmerMotDePasse" class="text-danger"></span>
                                </div>

                                <div class="d-grid">
                                    <button type="submit" class="btn btn-warning btn-lg">
                                        <i class="fas fa-key me-2"></i>
                                        Réinitialiser les mots de passe
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Exemple -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-secondary">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        Exemples de format
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">Format ligne par ligne :</h6>
                            <pre class="bg-light p-3 rounded"><code>EMP001
EMP002
EMP003
EMP004</code></pre>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">Format séparé par virgules :</h6>
                            <pre class="bg-light p-3 rounded"><code>EMP001, EMP002, EMP003, EMP004</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Validation en temps réel
    document.getElementById('NouveauMotDePasse').addEventListener('input', function() {
        const password = this.value;
        const confirmPassword = document.getElementById('ConfirmerMotDePasse');
        
        if (password.length < 6) {
            this.setCustomValidity('Le mot de passe doit contenir au moins 6 caractères.');
        } else {
            this.setCustomValidity('');
        }
        
        // Vérifier la correspondance
        if (confirmPassword.value && password !== confirmPassword.value) {
            confirmPassword.setCustomValidity('Les mots de passe ne correspondent pas.');
        } else {
            confirmPassword.setCustomValidity('');
        }
    });

    document.getElementById('ConfirmerMotDePasse').addEventListener('input', function() {
        const password = document.getElementById('NouveauMotDePasse').value;
        const confirmPassword = this.value;
        
        if (password !== confirmPassword) {
            this.setCustomValidity('Les mots de passe ne correspondent pas.');
        } else {
            this.setCustomValidity('');
        }
    });

    // Confirmation avant soumission
    document.querySelector('form').addEventListener('submit', function(e) {
        const matricules = document.getElementById('Matricules').value.trim();
        const password = document.getElementById('NouveauMotDePasse').value;
        
        if (!matricules) {
            e.preventDefault();
            alert('Veuillez saisir au moins un matricule.');
            return;
        }
        
        if (!password) {
            e.preventDefault();
            alert('Veuillez saisir un nouveau mot de passe.');
            return;
        }
        
        const matriculeList = matricules.split(/[\n\r,;]/).filter(m => m.trim()).length;
        const message = `Êtes-vous sûr de vouloir réinitialiser le mot de passe pour ${matriculeList} utilisateur(s) ?`;
        
        if (!confirm(message)) {
            e.preventDefault();
        }
    });
</script>
}
