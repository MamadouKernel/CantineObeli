@{
    ViewData["Title"] = "Changer le mot de passe";
}

<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <h4 class="card-title mb-0 text-center">
                    <i class="bi bi-key text-primary me-2"></i>Changer le mot de passe
                </h4>
            </div>
            <div class="card-body">
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger" role="alert">
                        <ul class="mb-0">
                            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                            {
                                <li>@error.ErrorMessage</li>
                            }
                        </ul>
                    </div>
                }

                <form asp-action="ChangePassword" method="post" id="changePasswordForm">
                    @Html.AntiForgeryToken()
                    
                    <!-- Mot de passe actuel -->
                    <div class="mb-3">
                        <label for="motDePasseActuel" class="form-label">Mot de passe actuel *</label>
                        <input type="password" 
                               class="form-control" 
                               id="motDePasseActuel" 
                               name="motDePasseActuel" 
                               required 
                               autocomplete="current-password" />
                    </div>

                    <!-- Nouveau mot de passe -->
                    <div class="mb-3">
                        <label for="nouveauMotDePasse" class="form-label">Nouveau mot de passe *</label>
                        <input type="password" 
                               class="form-control" 
                               id="nouveauMotDePasse" 
                               name="nouveauMotDePasse" 
                               required 
                               minlength="8"
                               autocomplete="new-password" />
                        <div class="form-text">Minimum 8 caractères</div>
                    </div>

                    <!-- Confirmation du nouveau mot de passe -->
                    <div class="mb-4">
                        <label for="confirmation" class="form-label">Confirmation du nouveau mot de passe *</label>
                        <input type="password" 
                               class="form-control" 
                               id="confirmation" 
                               name="confirmation" 
                               required 
                               autocomplete="new-password" />
                        <div class="form-text" id="passwordMatch"></div>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Changer le mot de passe
                        </button>
                        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Retour à l'accueil
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Conseils de sécurité -->
        <div class="card border-0 shadow-sm mt-3">
            <div class="card-header bg-light border-0">
                <h6 class="card-title mb-0">
                    <i class="bi bi-shield-check text-success me-2"></i>Conseils de sécurité
                </h6>
            </div>
            <div class="card-body">
                <ul class="small mb-0">
                    <li>Utilisez au moins 8 caractères</li>
                    <li>Combinez lettres, chiffres et symboles</li>
                    <li>Évitez les informations personnelles</li>
                    <li>Ne partagez jamais votre mot de passe</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Validation de la confirmation du mot de passe
        document.getElementById('confirmation').addEventListener('input', function() {
            const nouveauMotDePasse = document.getElementById('nouveauMotDePasse').value;
            const confirmation = this.value;
            const message = document.getElementById('passwordMatch');
            
            if (confirmation === '') {
                message.textContent = '';
                message.className = 'form-text';
            } else if (nouveauMotDePasse === confirmation) {
                message.textContent = '✓ Les mots de passe correspondent';
                message.className = 'form-text text-success';
            } else {
                message.textContent = '✗ Les mots de passe ne correspondent pas';
                message.className = 'form-text text-danger';
            }
        });

        // Validation du formulaire
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            const nouveauMotDePasse = document.getElementById('nouveauMotDePasse').value;
            const confirmation = document.getElementById('confirmation').value;
            
            if (nouveauMotDePasse !== confirmation) {
                e.preventDefault();
                alert('Les nouveaux mots de passe ne correspondent pas. Veuillez vérifier.');
                return false;
            }
            
            if (nouveauMotDePasse.length < 8) {
                e.preventDefault();
                alert('Le nouveau mot de passe doit contenir au moins 8 caractères.');
                return false;
            }
        });
    </script>
}
