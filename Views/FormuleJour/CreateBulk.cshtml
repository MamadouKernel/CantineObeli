@model Obeli_K.Models.ViewModels.CreateBulkFormuleViewModel

@{
    ViewData["Title"] = "Création en Lot de Formules";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-calendar-plus text-primary me-2"></i>
                        Création en Lot de Formules
                    </h3>
                </div>
                <div class="card-body">
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <form asp-action="CreateBulk" method="post">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <!-- Période -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-calendar-alt me-2"></i>
                                    Période de création
                                </h5>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="DateDebut" class="form-label"></label>
                                    <input asp-for="DateDebut" class="form-control" />
                                    <span asp-validation-for="DateDebut" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="DateFin" class="form-label"></label>
                                    <input asp-for="DateFin" class="form-control" />
                                    <span asp-validation-for="DateFin" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Options -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-cog me-2"></i>
                                    Options
                                </h5>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input asp-for="ExclureWeekends" class="form-check-input" />
                                    <label asp-for="ExclureWeekends" class="form-check-label"></label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input asp-for="RemplacerExistantes" class="form-check-input" />
                                    <label asp-for="RemplacerExistantes" class="form-check-label"></label>
                                </div>
                            </div>
                        </div>

                        <!-- Informations de la formule -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-utensils me-2"></i>
                                    Informations de la formule
                                </h5>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="NomFormule" class="form-label"></label>
                                    <input asp-for="NomFormule" class="form-control" placeholder="Ex: Formule du jour" />
                                    <span asp-validation-for="NomFormule" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="TypeFormuleId" class="form-label">Type de formule</label>
                                    <select asp-for="TypeFormuleId" class="form-select" asp-items="ViewBag.TypeFormules">
                                        <option value="">-- Sélectionner un type --</option>
                                    </select>
                                    <span asp-validation-for="TypeFormuleId" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Formule Améliorée -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-warning mb-3">
                                    <i class="fas fa-star me-2"></i>
                                    Formule Améliorée
                                </h6>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Entree" class="form-label"></label>
                                    <input asp-for="Entree" class="form-control" placeholder="Ex: Salade verte" />
                                    <span asp-validation-for="Entree" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Plat" class="form-label"></label>
                                    <input asp-for="Plat" class="form-control" placeholder="Ex: Poulet rôti" />
                                    <span asp-validation-for="Plat" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Garniture" class="form-label"></label>
                                    <input asp-for="Garniture" class="form-control" placeholder="Ex: Riz pilaf" />
                                    <span asp-validation-for="Garniture" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Dessert" class="form-label"></label>
                                    <input asp-for="Dessert" class="form-control" placeholder="Ex: Fruit" />
                                    <span asp-validation-for="Dessert" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Formule Standard -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-info mb-3">
                                    <i class="fas fa-utensils me-2"></i>
                                    Formule Standard
                                </h6>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="PlatStandard1" class="form-label"></label>
                                    <input asp-for="PlatStandard1" class="form-control" placeholder="Ex: Sauce graine" />
                                    <span asp-validation-for="PlatStandard1" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="GarnitureStandard1" class="form-label"></label>
                                    <input asp-for="GarnitureStandard1" class="form-control" placeholder="Ex: Viande" />
                                    <span asp-validation-for="GarnitureStandard1" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="PlatStandard2" class="form-label"></label>
                                    <input asp-for="PlatStandard2" class="form-control" placeholder="Ex: Attieke" />
                                    <span asp-validation-for="PlatStandard2" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="GarnitureStandard2" class="form-label"></label>
                                    <input asp-for="GarnitureStandard2" class="form-control" placeholder="Ex: Poisson" />
                                    <span asp-validation-for="GarnitureStandard2" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Compléments -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-success mb-3">
                                    <i class="fas fa-leaf me-2"></i>
                                    Compléments
                                </h6>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Feculent" class="form-label"></label>
                                    <input asp-for="Feculent" class="form-control" placeholder="Ex: Riz" />
                                    <span asp-validation-for="Feculent" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Legumes" class="form-label"></label>
                                    <input asp-for="Legumes" class="form-control" placeholder="Ex: Légumes de saison" />
                                    <span asp-validation-for="Legumes" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Paramètres -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-secondary mb-3">
                                    <i class="fas fa-sliders-h me-2"></i>
                                    Paramètres
                                </h6>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Marge" class="form-label"></label>
                                    <input asp-for="Marge" class="form-control" type="number" min="0" max="100" placeholder="0" />
                                    <span asp-validation-for="Marge" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Statut" class="form-label"></label>
                                    <select asp-for="Statut" class="form-select">
                                        <option value="1">Actif</option>
                                        <option value="0">Inactif</option>
                                    </select>
                                    <span asp-validation-for="Statut" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Boutons d'action -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a asp-action="Index" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i>
                                        Retour à la liste
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-calendar-plus me-1"></i>
                                        Créer les formules
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Auto-dismiss alerts after 5 seconds
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);

        // Calculer automatiquement la date de fin (7 jours après le début)
        document.getElementById('DateDebut').addEventListener('change', function() {
            const dateDebut = new Date(this.value);
            if (dateDebut) {
                const dateFin = new Date(dateDebut);
                dateFin.setDate(dateFin.getDate() + 6); // 7 jours au total
                document.getElementById('DateFin').value = dateFin.toISOString().split('T')[0];
            }
        });
    </script>
}
